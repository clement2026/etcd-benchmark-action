---
name: Benchmarks on AMD64
permissions: read-all
on: [ push, workflow_dispatch ]
jobs:
  benchmark-pull-request:
    runs-on: ubuntu-latest-8-cores
    steps:
      - uses: actions/checkout@v4
      #        with:
      #          repository: 'clement2026/etcd'
      #          fetch-depth: 0
      - uses: actions/setup-go@v5
        with:
          go-version: '1.23'
      - name: chmod
        run: chmod +x ./scripts/benchmark.sh
      - name: Run Benchmarks
        run: ./scripts/benchmark.sh
      - run: |
          echo "\`\`\`" >> "$GITHUB_STEP_SUMMARY"
          cat result.csv >> "$GITHUB_STEP_SUMMARY"
          echo "\`\`\`" >> "$GITHUB_STEP_SUMMARY"
          cat <<EOL >> "$GITHUB_STEP_SUMMARY"
          <hr />
          The table shows the median and 90% confidence interval (CI) summaries for each benchmark comparing the HEAD and the BASE of the pull request, and an A/B comparison under "vs base". The last column shows the statistical p-value with ten runs (n=10).
          The last row has the Geometric Mean (geomean) for the given rows in the table.
          Refer to [benchstat's documentation](https://pkg.go.dev/golang.org/x/perf/cmd/benchstat) for more help.
          EOL
